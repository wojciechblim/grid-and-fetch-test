<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <div class="a">

    </div>
    <script type="text/javascript">
    // npm run start

  function AppView(){
    this.table = document.createElement("table");
    this.rowModels = [];
    this.sort = "asc";
    this.rowViesStore = [];
//zrobic fetch na zewntrz i wykorzystac dane json jakie fetch zwroci
    const promise = fetch('https://jsonplaceholder.typicode.com/comments');
    promise.then(response => response.json())
      .then(json => {

        //CREATE FIRST ROW
        const header = json[0];
        const headerElement = document.createElement('tr');

        Object.keys(header).forEach(key => {
          const cell = document.createElement('th');
          const cellContent = document.createTextNode(key);
          cell.appendChild(cellContent);

          cell.addEventListener('click',event=>{
            const compare = this.compare(key);

            const compareUpdated = compare(this.sort);
            this.rowModels.sort(compareUpdated);
            this.clearViews();
            this.rowViewRender();
            if(this.sort == "asc"){
              this.sort = "desc";
            }else{
              this.sort = "asc";
            }
          });
          headerElement.appendChild(cell);
        });
        
        this.table.appendChild(headerElement);

        //CREATE REST
        this.rowModels = json;
        this.rowViewRender();
      });
  }

  AppView.prototype = {
    render(){
      return this.table;
    },
    compare(property){
      return function(direction){
        const dir = direction;
        return function(a,b){
          if(a[property]<b[property]){
            return dir=="asc"?-1:1;
          }else if(a[property]>b[property]){
            return dir=="asc"?1:-1;
          }else{
            return 0;
          }
        }
      }
    },
    rowViewRender(){//update
      this.rowModels.map(model => new RowView(model))
        .forEach(view => this.table.appendChild(view.render()));
        //mozna tez tzrymac widoki w tablicy i dodac if funkcje ktora je delete
    },
    clearViews(){
      const parent = document.querySelector("table");
      while(parent.firstChild){
        parent.removeChild(parent.lastChild);
        if(document.getElementsByTagName("tr").length<2){
          break;
        }
      }
    }
  }


  function RowView(model){
    this.row = document.createElement("tr");
    Object.keys(model).forEach(key => {
      const td = document.createElement("td");
      const input = document.createTextNode(model[key]);
      td.appendChild(input);
      this.row.appendChild(td);
    });
  }

  RowView.prototype = {
    render(){
      return this.row;
    }
  }

  document.addEventListener("DOMContentLoaded", function(event){
    const app = new AppView();
    document.querySelector(".a").appendChild(app.render());
  });
  //then(value => success)
  //catch(errer => faile)

  //const p = new Promise ((resolve, reject) => setTimeout(() => resolve(42), 4000))
//stworzyc tablice z naglowkami, po kliknieciu w naglowek posortowac od ascen do desc - zrobic modele np na row i widoki

    </script>
  </body>
</html>
